# LapSpec Analyzer

**LapSpec Analyzer** は、ノートPCの内蔵マイクを使用して、スピーカーや音響空間の周波数特性をブラウザ上で手軽に測定・解析するためのツールです。

## 概要 (Overview)

このシステムは、外部の測定用マイクやオーディオインターフェースを使わず、**「手持ちのノートPC一台で、その場の音響状態をざっくり把握する」**ことを目的として設計されています。

一般的な観賞用ビジュアライザーとは異なり、音響エンジニアリングやピアノの音響解析といった視点から、人間の聴覚特性に近い**対数スケール（Log Scale）**での表示と、物理シミュレーションに基づく精密なピークホールドを実装しています。

※本ツールは、ユーザーの構想に基づき、AI（大規模言語モデル）との対話を通じて共同で設計・実装されました。

## 主な機能 (Features)

- **デュアル表示**: リアルタイム波形（オシロスコープ）と周波数分布（スペクトルアナライザー）を個別に表示。
- **PD制御ピークホールド**: 物理学的なPD制御（比例・微分制御）を応用し、「高い音圧付近ではゆっくりと粘り、離れると加速して落下する」エモーショナルかつ視認性の高いピーク表示を実現。
- **高解像度サンプリング**: 低周波領域での描画ロジックを最適化。1つのビン（周波数の最小単位）が横に太く広がる「ガバガバ」な表示を抑え、ピアノの低音などの鋭いピークを正確に捉えます。
- **可変FFTサイズ**: 2048から最大16384まで、解析目的に応じて周波数解像度を動的に切り替え可能。
- **独立したゲイン制御**: 入力ゲイン、オシロ倍率、スペクトル倍率を個別に微調整可能。

## 使い方 (How to Use)

1. `test.html` をブラウザで開きます。
2. 「マイク開始」ボタンをクリックし、マイクの使用を許可します。
3. 測定したい音源（ピアノ、スピーカー等）を鳴らし、グラフを確認します。
4. 目的に合わせて「FFTサイズ」を選択し、各ゲインスライダーで波形が見やすい大きさに調整してください。

## 正確に測定するためのヒント (Measurement Tips)

ノートPCの内蔵マイクでより正確な特性を調べ、意図しない音の消失を防ぐために、以下の設定を強く推奨します。

- **OSの音響効果（ノイズ抑制）をオフにする**:
  Windowsの場合、「設定」→「システム」→「サウンド」→「すべてのサウンドデバイス」から入力デバイスを選択し、**「オーディオの強化」をオフ**にしてください。
  **重要**: ノイズ抑制機能が有効な場合、一定の持続音や微小な残響が「ノイズ」と判定されて消されてしまい、正しい測定ができません。
- **マイクの向き**:
  ノートPCのマイク位置（ベゼルの上やキーボード付近）を音源に向けて設置してください。

/* ## 開発者向け (For Developers)

- **技術スタック**: HTML5 / JavaScript (Web Audio API) / Canvas API
- **物理演算**: `updatePeakPhysics` 関数にて、極めて微小な `Kp`（比例定数）と `Kd`（微分定数）を用いたPD制御を行い、独自の減衰感を作っています。 */

## ライセンス (License)

MIT License (or your preferred license)